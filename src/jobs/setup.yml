parameters:
  cache-version:
    type: string
    default: v1
  checkout-method:
    type: enum
    enum: [blobless, full]
    default: blobless
  install-command:
    type: string
    default: ''
  pkg-manager:
    type: enum
    enum: [yarn, yarn-berry]
    default: yarn

executor: default

environment:
  HUSKY: 0

steps:
  - checkout:
      method: <<parameters.checkout-method>>
  - when:
      condition:
        equal: [yarn, <<parameters.pkg-manager>>]
      steps:
        - node/install:
            install-yarn: true
  - node/install-packages:
      cache-path: node_modules
      cache-version: <<parameters.cache-version>>
      override-ci-command: <<parameters.install-command>>
      pkg-manager: <<parameters.pkg-manager>>
      include-branch-in-cache-key: false
      check-cache: always
  - persist_to_workspace:
      root: .
      paths:
        - '*'
